<div class="file-management">
  <div class="card">
    <h2>File Management</h2>
    <app-file-upload (fileUploaded)="loadFiles()"></app-file-upload>
  </div>

  <div class="card">
    <div class="search-bar">
      <input
        type="text"
        class="form-control"
        [(ngModel)]="searchTerm"
        (keyup.enter)="searchFiles()"
        placeholder="Search files by name, tags, or type..."
      />
      <button class="btn btn-primary" (click)="searchFiles()">Search</button>
      <button class="btn btn-secondary" (click)="clearSearch()" *ngIf="searchTerm">Clear</button>
    </div>
  </div>

  <div class="card">
    <table class="table">
      <thead>
        <tr>
          <th>File Name</th>
          <th>Type</th>
          <th>Size</th>
          <th>Uploaded By</th>
          <th>Uploaded At</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let file of files">
          <td>{{ file.originalFileName }}</td>
          <td>{{ file.contentType }}</td>
          <td>{{ formatFileSize(file.sizeInBytes) }}</td>
          <td>{{ file.createdBy }}</td>
          <td>{{ formatDate(file.createdAt) }}</td>
          <td>
            <div class="action-buttons">
              <button
                class="btn btn-primary"
                (click)="previewFile(file)"
                *ngIf="canPreview(file.contentType)"
              >
                Preview
              </button>
              <button class="btn btn-primary" (click)="downloadFile(file)">Download</button>
              <button class="btn btn-danger" (click)="softDeleteFile(file)">Delete</button>
              <button
                class="btn btn-danger"
                (click)="hardDeleteFile(file)"
                *ngIf="isAdmin()"
              >
                Hard Delete
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="files.length === 0">
          <td colspan="6" class="text-center">No files found</td>
        </tr>
      </tbody>
    </table>

    <div class="pagination" *ngIf="pagedResult">
      <button
        class="btn"
        (click)="goToPage(pagedResult.pageNumber - 1)"
        [disabled]="!pagedResult.hasPreviousPage"
      >
        Previous
      </button>
      <span class="page-info">
        Page {{ pagedResult.pageNumber }} of {{ pagedResult.totalPages }}
        ({{ pagedResult.totalCount }} total files)
      </span>
      <button
        class="btn"
        (click)="goToPage(pagedResult.pageNumber + 1)"
        [disabled]="!pagedResult.hasNextPage"
      >
        Next
      </button>
    </div>
  </div>

  <!-- Preview Modal -->
  <div class="modal" *ngIf="previewFileData" (click)="closePreview()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <span class="modal-close" (click)="closePreview()">&times;</span>
      <img *ngIf="previewFileData.type.startsWith('image/')" [src]="previewFileData.url" alt="Preview" />
      <iframe *ngIf="previewFileData.type === 'application/pdf'" [src]="previewFileData.url" style="width: 100%; height: 80vh;"></iframe>
    </div>
  </div>
</div>

